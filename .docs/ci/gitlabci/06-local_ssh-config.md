# Урок 6: Настройка локального компьютера для работы с GitLab по SSH

После того как вы установили GitLab, создали пользователя и добавили свой публичный SSH-ключ в профиль, вы готовы клонировать свой первый репозиторий. Однако, если у вас несколько SSH-ключей, Git может попытаться использовать не тот, что вы добавили в GitLab.

## Проблема: Ошибка при клонировании

При попытке клонировать репозиторий стандартной командой:
```bash
git clone git@gitlab.your_domain.xyz:username/project.git
```

Вы, скорее всего, получите одну из двух ошибок:
1.  `ssh: connect to host gitlab.your_domain.xyz port 22: Connection refused` — это означает, что Git пытается подключиться к стандартному 22-му порту, который на нашем сервере занят системным SSH, а не GitLab.
2.  `Permission denied (publickey)` — это может произойти, если у вас несколько SSH-ключей, и Git по умолчанию пытается использовать не тот, который вы добавили в GitLab.

## Решение: Файл конфигурации SSH (`~/.ssh/config`)

Чтобы решить обе эти проблемы раз и навсегда, нужно создать или отредактировать файл `~/.ssh/config` на **вашем локальном компьютере**. Этот файл позволяет задать индивидуальные параметры подключения для разных SSH-хостов.

### Шаг 1: Создание и редактирование файла `config`

1.  Откройте терминал на вашем локальном компьютере (macOS, Linux или Git Bash на Windows).
2.  Откройте файл в текстовом редакторе. Если его нет, он будет создан.
    ```bash
    nano ~/.ssh/config
    ```

### Шаг 2: Добавление конфигурации для GitLab

Добавьте в файл следующий блок, заменив `gitlab.your_domain.xyz` на ваш домен и, при необходимости, путь к вашему ключу.

```ini
# Конфигурация для подключения к вашему серверу GitLab
Host gitlab.your_domain.xyz
    HostName gitlab.your_domain.xyz
    User git
    Port 2222
    IdentityFile ~/.ssh/id_ed25519
    IdentitiesOnly yes
```

*   Нажмите `Ctrl + O` для сохранения и `Ctrl + X` для выхода из `nano`.

### Шаг 3: Разбор параметров

| Параметр | Описание |
| :--- | :--- |
| `Host gitlab.your_domain.xyz` | Псевдоним, который вы будете использовать в командах (`git clone`, `ssh`). |
| `HostName gitlab.your_domain.xyz` | Реальное доменное имя или IP-адрес сервера. |
| `User git` | Имя пользователя для подключения. Для всех операций с Git в GitLab всегда используется пользователь `git`. |
| `Port 2222` | **Ключевой параметр.** Указывает нестандартный порт, на котором GitLab принимает SSH-соединения (мы настроили его в `docker-compose.yml`). |
| `IdentityFile ~/.ssh/id_ed25519` | Явно указывает, какой **приватный** ключ использовать для этого хоста. Замените на путь к вашему ключу, если он другой (например, `~/.ssh/id_rsa`). |
| `IdentitiesOnly yes` | Запрещает SSH-клиенту пробовать другие ключи, если указанный в `IdentityFile` не подошел. Это ускоряет подключение и делает его более предсказуемым. |

## Проверка

Теперь, когда конфигурация сохранена, вы можете проверить соединение с GitLab одной командой:

```bash
ssh -T git@gitlab.your_domain.xyz
```

Если все настроено правильно, вы увидите приветственное сообщение от GitLab:

```
Welcome to GitLab, @your_username!
```

После этого стандартная команда `git clone git@gitlab.your_domain.xyz:username/project.git` будет работать без каких-либо проблем, так как Git автоматически подхватит все параметры из вашего `~/.ssh/config`.
