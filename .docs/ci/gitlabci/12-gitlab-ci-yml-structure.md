# Урок 12: Создание первого пайплайна

Прежде чем создавать сложный пайплайн со множеством этапов, важно убедиться, что основная связка "GitLab <-> Runner" работает корректно. Для этого мы создадим максимально простой `.gitlab-ci.yml`, который содержит всего одну задачу.

Цель этого урока — запустить первый пайплайн и убедиться, что наш зарегистрированный Runner успешно подхватывает и выполняет задачу.

## Структура файла `.gitlab-ci.yml`

Вот как выглядит наш первый, проверочный пайплайн:

```yaml
default:
  image: $CI_REGISTRY_IMAGE/android-builder:latest
  tags:
    - docker

stages:
  - check_pipeline

check_job:
  stage: check_pipeline
  script:
    - echo "Проверка пайплайна"
```

### Разбор файла

1.  **`default` (Настройки по умолчанию):**
    *   `image: $CI_REGISTRY_IMAGE/android-builder:latest`: Эта строка говорит GitLab, что все задачи по умолчанию должны запускаться внутри нашего кастомного Docker-образа для Android. `$CI_REGISTRY_IMAGE` — это переменная GitLab, которая автоматически подставляет путь к Container Registry нашего проекта.
    *   `tags: - docker`: Указывает, что задачи должны выполняться только на тех Runner'ах, у которых есть тег `docker`. Мы задавали этот тег при регистрации Runner'а.

2.  **`stages` (Этапы):**
    *   Мы определяем всего один этап с именем `check_pipeline`.

3.  **`check_job` (Задача для проверки):**
    *   `stage: check_pipeline`: Привязывает эту задачу к нашему единственному этапу.
    *   `script: - echo "Проверка пайплайна"`: Это единственная команда, которую выполнит Runner. Он просто выведет строку "Проверка пайплайна" в лог.

## Как это работает?

1.  Вы отправляете (`git push`) этот файл в ваш GitLab-репозиторий.
2.  GitLab видит файл `.gitlab-ci.yml` и создает новый пайплайн.
3.  Он находит задачу `check_job` и ищет свободный Runner с тегом `docker`.
4.  Наш Runner на сервере принимает задачу.
5.  Runner (будучи Docker-executor'ом) скачивает образ `$CI_REGISTRY_IMAGE/android-builder:latest`, запускает из него контейнер и выполняет внутри команду `echo "Проверка пайплайна"`.
6.  Если все прошло успешно, вы увидите в интерфейсе GitLab (в разделе **Build -> Pipelines**) успешно завершенный пайплайн.

Если этот простой пайплайн работает, значит, вся инфраструктура настроена верно, и можно переходить к добавлению реальных задач: анализа, тестов и сборки.