= Настройка HTTPS с помощью Certbot

Теперь, когда Nginx настроен для обработки HTTP-трафика для наших доменов, последний шаг — защитить их с помощью HTTPS. Мы сделаем это с помощью `certbot` и его плагина для Nginx.

== Шаг 1: Запуск Certbot

Выполните одну команду, указав все домены, для которых вы хотите получить сертификаты.

[source,bash]
----
sudo certbot --nginx --redirect -d gitlab.<ваш-домен>.xyz -d s3.<ваш-домен>.xyz
----

[TIP]
====
*   `--nginx`: Указывает `certbot` использовать плагин для Nginx. Он автоматически найдет ваши конфигурационные файлы и изменит их.
*   `--redirect`: Явно указывает `certbot` настроить автоматическое перенаправление всех HTTP-запросов на HTTPS.
*   `-d ...`: Указывает домен, для которого нужен сертификат. Можно указать несколько.
====

`certbot` задаст несколько вопросов (например, ваш email для уведомлений и согласие с условиями). После их ответа он:
. Свяжется с серверами Let's Encrypt для подтверждения владения доменами.
. Получит SSL-сертификаты.
. Автоматически изменит ваши конфигурационные файлы Nginx (в `/etc/nginx/sites-enabled/`), добавив в них пути к сертификатам и настройки для HTTPS.

== Шаг 2: Автоматическое обновление

Пакет `certbot`, который мы установили, автоматически настраивает системный таймер (`systemd timer` или `cron job`), который будет дважды в день пытаться обновить сертификаты. Обновление произойдет только в том случае, если до истечения срока действия сертификата осталось менее 30 дней.

Вам не нужно ничего делать вручную. Проверить статус таймера можно командой: `sudo systemctl list-timers | grep certbot`.