= Отладка Nginx: Статус, Конфигурация и Логи

Этот документ содержит основные команды для диагностики и решения проблем с Nginx.

== 1. Проверка статуса сервиса

Первый шаг — убедиться, что сервис Nginx вообще запущен.

[source,bash]
----
sudo systemctl status nginx.service
----

*   **Зеленый `active (running)`:** Сервис работает.
*   **Красный `failed` или `inactive (dead)`:** Сервис не запущен. Ищите причину в логах.

== 2. Проверка синтаксиса конфигурации

**Перед каждым перезапуском** Nginx обязательно проверяйте конфигурацию на наличие синтаксических ошибок.

[source,bash]
----
sudo nginx -t
----

Если вы видите `syntax is ok` и `test is successful`, можно безопасно перезапускать сервис. В противном случае команда укажет на файл и строку с ошибкой.

== 3. Просмотр логов

Логи — основной источник информации при отладке. Они находятся в `/var/log/nginx/`.

=== Лог ошибок (`error.log`)

Сюда записываются все проблемы: ошибки конфигурации, проблемы с доступом, ошибки при связи с бэкенд-сервисами (например, `502 Bad Gateway`).

*Для просмотра лога в реальном времени (самый полезный способ):*
[source,bash]
----
sudo tail -f /var/log/nginx/error.log
----

=== Лог доступа (`access.log`)

Сюда записывается информация о каждом успешном запросе. Полезно, чтобы убедиться, что трафик доходит до Nginx.

[source,bash]
----
sudo tail -f /var/log/nginx/access.log
----

== 4. Диагностика петли переадресации (ERR_TOO_MANY_REDIRECTS)

Эта ошибка возникает, когда браузер попадает в бесконечный цикл перенаправлений (например, с HTTP на HTTPS и обратно).

=== Способ 1: Инструменты разработчика в браузере (Network Tab)

Это самый наглядный способ.

.  Откройте в браузере инструменты разработчика (`Cmd+Option+I` на macOS, `Ctrl+Shift+I` или `F12` на Windows/Linux).
.  Перейдите на вкладку **"Сеть" (Network)**.
.  Убедитесь, что установлена галочка **"Сохранять журнал" (Preserve log)**.
.  Попробуйте открыть ваш сайт.

Вы увидите длинный список одинаковых запросов со статусом `301` или `302`, которые перенаправляют сами на себя.

=== Способ 2: Лог доступа Nginx

1.  Смотрите лог доступа в реальном времени: `sudo tail -f /var/log/nginx/access.log`
2.  Откройте сайт в браузере.

Вы увидите в терминале непрерывный поток одинаковых GET-запросов, что подтверждает наличие петли.
----