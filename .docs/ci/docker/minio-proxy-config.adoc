= Конфигурация Nginx для MinIO (Решение 502 Bad Gateway)

При настройке Nginx в качестве обратного прокси для MinIO часто возникает ошибка `502 Bad Gateway`. Она означает, что Nginx не может получить корректный ответ от сервиса MinIO.

== Причина

Проблема заключается в том, что для корректной работы за прокси-сервером MinIO требует передачи нескольких специфичных HTTP-заголовков, которые связаны с протоколом AWS S3. Без них MinIO не может правильно обработать входящий запрос от Nginx и не возвращает ответ.

== Решение

Решение заключается в добавлении недостающих `proxy_set_header` директив в конфигурационный файл Nginx для домена, который обслуживает MinIO (например, `/etc/nginx/sites-available/s3.<ваш-домен>.xyz`).

=== Эталонная конфигурация `location`

Вот как должна выглядеть полная и правильная секция `location /` для MinIO:

[source,nginx]
----
location / {
    proxy_pass http://localhost:9002; # Указываем на внутренний порт MinIO

    # --- Стандартные заголовки для прокси ---
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # --- Обязательные заголовки для MinIO (S3) ---
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    proxy_set_header X-Amz-Content-Sha256 $http_x_amz_content_sha256;
    # ---------------------------------------------
}
----

=== Объяснение дополнительных заголовков

*   `proxy_set_header X-Forwarded-Host $host;`: Передает оригинальное имя хоста (домена), к которому обратился клиент.
*   `proxy_set_header X-Forwarded-Port $server_port;`: Передает оригинальный порт (80 или 443).
*   `proxy_set_header X-Amz-Content-Sha256 $http_x_amz_content_sha256;`: Передает хэш содержимого запроса. Это критически важный заголовок для аутентификации запросов по протоколу AWS S3, который использует MinIO.

После добавления этих заголовков и перезагрузки Nginx (`sudo systemctl reload nginx`) ошибка `502 Bad Gateway` должна быть устранена.