# Стратегия тестирования и План (Testing Strategy)

Этот документ определяет комплексную стратегию автоматизированного тестирования для проекта, основанную на классической модели **пирамиды тестирования**. План структурирован по уровням для обеспечения максимального покрытия и качества.

---

## Уровень 1: Модульные тесты (Unit Tests)

**Цель:** Проверить корректность работы отдельных классов и методов в полной изоляции от Android SDK, базы данных и сети. Это самые быстрые и стабильные тесты.

**Инструменты:** JUnit 5, MockK, Truth.

### Чек-лист:
- **`ViewModels`**
    - [ ] `ProductCatalogViewModel`: Проверить вызов нужных методов DAO при сортировке.
    - [ ] `ProductCatalogViewModel`: Проверить логику визуальных изменений (`generateVisualChanges` и `findProductByName`).
    - [ ] `ProductDetailViewModel`: Проверить вызов DAO для получения продукта по ID.
    - [ ] `SplashViewModel`: Проверить вызов DAO для вставки и получения продуктов.
- **`Utils` и `Converters`**
    - [ ] `Methods`: Проверить расчет общей стоимости (`getTotalPrice`).
    - [ ] `Methods`: Проверить валидацию пароля (`isValidPassword`).
    - [ ] `Methods`: Проверить сравнение строк (`isEqual`).
    - [ ] `Methods`: Проверить подсчет общего количества товаров (`getTotalNum`).
    - [ ] `ColorModelConverters`: Проверить корректность JSON-сериализации и десериализации.
- **Логика валидации `LoginFragment`**
    - [ ] Проверить валидацию полей и логику проверки заблокированного пользователя.
    - [ ] _(Примечание: Эта логика будет вынесена в ViewModel на этапе рефакторинга бизнес-логики)._

---

## Уровень 2: Интеграционные тесты (Integration Tests)

**Цель:** Проверить корректность взаимодействия между несколькими компонентами системы.

**Инструменты:** JUnit 5, `AndroidJUnitRunner`, Room Testing (`inMemoryDatabaseBuilder`), MockWebServer.

### Чек-лист:
- **Интеграция с базой данных (Room)**
    - [ ] `AppDao`: Проверить, что после вставки (`insertProduct`) продукт корректно извлекается (`getAllProducts`, `getProduct`).
    - [ ] `AppDao`: Проверить, что продукт корректно удаляется (`delete`).
    - [ ] `AppDao`: Проверить, что методы сортировки (`getPersonsSortBy...`) возвращают список в правильном порядке.
- **Интеграция с сетью (API)**
    - [ ] `Network.java`: С помощью `MockWebServer` проверить корректность формирования GET и POST запросов.
    - [ ] `Network.java`: Проверить добавление заголовков `User-Agent` и `X-Trace-ID`.
    - [ ] `Network.java`: Проверить обработку успешных (200) и ошибочных (4xx, 5xx) ответов.
- _(Примечание: После написания этих тестов будет проведен этап рефакторинга для улучшения кода, связанного с базой данных и сетью)._

---

## Уровень 3: UI-тестирование (Пирамида UI-тестов)

**Цель:** Проверить приложение с точки зрения конечного пользователя, применяя пирамидальный подход и к UI-тестам. Это позволяет эффективно распределить усилия: много быстрых тестов на отдельные экраны и мало медленных сквозных сценариев.

**Инструменты:** Espresso, Kakao, Kaspresso, JUnit 4.

### 3.1. Модульные UI-тесты (Component/Screen Tests)

**Цель:** Проверить UI и логику отдельных экранов (`Fragment`, `Activity`) в изоляции. Это основание пирамиды UI-тестов.
**Инструменты:** `FragmentScenario`, `ActivityScenarioRule`.

- [ ] **`LoginFragment`**: Проверить отображение элементов, автозаполнение полей, обработку ошибок.
- [ ] **`ProductCatalogFragment`**: Проверить отображение списка товаров (включая пустой список).
- [ ] **`ProductDetailFragment`**: Проверить отображение деталей, работу счетчика, добавление в корзину.
- [ ] **`CartFragment`**: Проверить отображение товаров, итоговой суммы, удаление.

### 3.2. Интеграционные UI-тесты (Navigation Tests)

**Цель:** Проверить корректность навигации и передачи данных между несколькими экранами.
**Инструменты:** Espresso, `Intents`.

- [ ] **Навигация "Каталог -> Детали"**: проверить корректность перехода и отображаемых данных.
- [ ] **Навигация "Корзина -> Логин -> Оформление"**: проверить условный переход при оформлении заказа.
- [ ] **Полный флоу оформления заказа (навигация)**: проверить последовательный переход по экранам `CheckoutInfo` -> `Checkout` -> `PlaceOrder` -> `CheckoutComplete`.

### 3.3. Системные E2E-тесты (End-to-End Tests)

**Цель:** Проверить сквозные пользовательские сценарии от начала до конца. Это вершина пирамиды UI-тестов.

- [ ] **`[E2E-1]` Полный цикл покупки (Happy Path)**: Авторизация -> Выбор товара -> Добавление в корзину -> Проверка корзины -> Оформление заказа.
- [ ] **`[E2E-2]` Попытка входа заблокированным пользователем**: Ввод данных заблокированного пользователя -> Проверка отображения ошибки.
- [ ] **`[E2E-3]` Сброс состояния приложения через меню**: Добавление товаров -> Сброс -> Проверка, что корзина пуста.
- _(Примечание: После написания этих тестов будет проведен этап рефакторинга для улучшения кода UI-компонентов)._