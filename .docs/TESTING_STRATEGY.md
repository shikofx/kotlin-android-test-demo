# Стратегия тестирования и План (Testing Strategy)

Этот документ определяет комплексную стратегию автоматизированного тестирования для проекта, основанную на анализе его архитектуры и компонент. План структурирован по уровням и типам тестов для обеспечения максимального покрытия и оценки качества.

---

## 1. Чек-лист для модульных тестов бизнес-логики (Unit Tests)

**Цель:** Проверить корректность работы отдельных классов и методов в полной изоляции от Android SDK, базы данных и сети. Это самые быстрые и стабильные тесты.

**Инструменты:** JUnit 5, MockK, Truth.

### `ViewModels`
- **`ProductCatalogViewModel`**
    - [ ] `getAllProducts()`: Убедиться, что при запросе сортировки (по имени, по цене) вызывается соответствующий метод DAO.
    - [ ] `getAllProducts()`: Убедиться, что `LiveData` `allProducts` корректно обновляется данными, возвращенными из DAO.
    - [ ] `generateVisualChanges()`: Проверить логику визуальных изменений: цены заменяются, изображения для первых двух элементов меняются.
- **`ProductDetailViewModel`**
    - [ ] `getProduct()`: Убедиться, что вызывается `mDb.personDao().getProduct(id)` с правильным ID.
    - [ ] `getProduct()`: Убедиться, что `LiveData` `product` обновляется данными из DAO.
- **`SplashViewModel`**
    - [ ] `getAllProducts()`: Проверить, что `LiveData` `allProducts` получает данные из DAO.
    - [ ] `insertProducts()`: Проверить, что вызывается `mDb.personDao().insertProduct()` и `pb` `LiveData` меняет значение на `View.GONE`.

### `Utils` и `Converters`
- **`Methods` (в `SingletonClass`)**
    - [ ] `getTotalPrice()`: Проверить корректность расчета общей стоимости для пустой корзины, корзины с одним и несколькими товарами.
    - [ ] `isValidPassword()`: Проверить валидацию для корректных и некорректных паролей (длина < 6).
- **`ColorModelConverters`**
    - [ ] `stringToSomeObjectList()`: Проверить корректное преобразование JSON-строки в `List<ColorModel>`.
    - [ ] `someObjectListToString()`: Проверить корректное преобразование `List<ColorModel>` в JSON-строку.
- **Логика валидации в `LoginFragment`** (Примечание: для лучшей тестируемости эту логику следует вынести в `LoginViewModel`)
    - [ ] Проверить сценарий с пустым полем "username".
    - [ ] Проверить сценарий с пустым полем "password".
    - [ ] Проверить сценарий с заблокированным пользователем (`alice@example.com`).

---

## 2. Чек-лист для компонентных UI тестов (UI Component Tests)

**Цель:** Проверить UI и логику отдельных экранов (`Fragment`, `Activity`) в изоляции.

**Инструменты:** Espresso, `FragmentScenario`, `ActivityScenarioRule`, JUnit 4.

- **`LoginFragment`**
    - [ ] При запуске экрана все элементы (поля ввода, кнопка, ссылки на пользователей) отображаются корректно.
    - [ ] При клике на ссылку "standard_user" поля "username" и "password" автоматически заполняются.
    - [ ] При вводе неверных данных и нажатии "Login" отображается соответствующее сообщение об ошибке.
- **`ProductCatalogFragment`**
    - [ ] При запуске фрагмента и получении данных от `ViewModel` отображается `RecyclerView` со списком товаров.
    - [ ] Проверить состояние, когда `ViewModel` возвращает пустой список.
- **`ProductDetailFragment`**
    - [ ] При запуске с ID продукта на экране отображается корректная информация о товаре (название, цена, описание).
    - [ ] Нажатие на кнопки "+" и "-" корректно изменяет отображаемое количество товара.
    - [ ] При нажатии "Add to cart" товар добавляется в `SingletonClass.cartItemList`.
- **`CartFragment`**
    - [ ] При запуске с непустой корзиной в `SingletonClass` на экране отображается список товаров и корректная итоговая сумма.
    - [ ] При запуске с пустой корзиной отображается блок "No Items".
    - [ ] Нажатие на кнопку "Remove" удаляет товар из списка и обновляет UI.

---

## 3. Чек-лист для интеграционных тестов API (API Integration Tests)

**Цель:** Проверить, что клиент (`Network.java`) корректно формирует и отправляет сетевые запросы.

**Инструменты:** MockWebServer, JUnit 4/5, OkHttp.

- **`Network.java`**
    - [ ] `fetch(GET)`: Убедиться, что при вызове `fetch` отправляется GET-запрос на указанный URL.
    - [ ] `post(POST)`: Убедиться, что при вызове `post` отправляется POST-запрос с правильным телом (`body`) и `Content-Type`.
    - [ ] Проверить, что ко всем запросам добавляются заголовки `User-Agent` и `X-Trace-ID`.
    - [ ] Проверить поведение при получении ответа с кодом 200 (успех).
    - [ ] Проверить поведение при получении ответа с кодом 404/500 (ошибка) - текущая реализация игнорирует ошибки, тест должен это зафиксировать.

---

## 4. Чек-лист для интеграционных тестов UI (UI Integration Tests)

**Цель:** Проверить навигацию и корректность передачи данных между различными экранами приложения.

**Инструменты:** Espresso, `Intents`, `ActivityScenario`.

- **Навигация "Каталог -> Детали"**
    - [ ] В `ProductCatalogFragment` нажать на элемент списка.
    - [ ] Убедиться, что открылся `ProductDetailFragment`.
    - [ ] Убедиться, что на экране деталей отображается информация именно о выбранном товаре.
- **Навигация "Корзина -> Логин -> Оформление заказа"**
    - [ ] В `CartFragment` (будучи неавторизованным) нажать "Checkout".
    - [ ] Убедиться, что открылся `LoginFragment`.
    - [ ] После успешного ввода данных на `LoginFragment` убедиться, что произошел переход на `CheckoutInfoFragment`.
- **Полный флоу оформления заказа (навигация)**
    - [ ] На `CheckoutInfoFragment` нажать "To Payment" -> открывается `CheckoutFragment`.
    - [ ] На `CheckoutFragment` нажать "Review Order" -> открывается `PlaceOrderFragment`.
    - [ ] На `PlaceOrderFragment` нажать "Place Order" -> открывается `CheckoutCompleteFragment`.

---

## 5. Чек-лист для системных тестов (System/E2E Tests)

**Цель:** Проверить сквозные пользовательские сценарии от начала до конца, имитируя действия реального пользователя.

**Инструменты:** Espresso, Kakao, Kaspresso.

- **`[E2E-1]` Полный цикл покупки (Happy Path)**
    - [ ] Запустить приложение, авторизоваться с данными "standard_user".
    - [ ] В каталоге выбрать товар, перейти на экран деталей.
    - [ ] Выбрать цвет, указать количество "2", нажать "Add To Cart".
    - [ ] Перейти в корзину через иконку в хедере.
    - [ ] Убедиться, что в корзине один товар в количестве 2 шт., итоговая сумма верна.
    - [ ] Нажать "Checkout", заполнить все поля на экранах `CheckoutInfo` и `Checkout`.
    - [ ] Нажать "Place Order".
    - [ ] Убедиться, что отображается экран "Checkout Complete".
    - [ ] Нажать "Continue Shopping", убедиться, что корзина пуста.
- **`[E2E-2]` Попытка входа заблокированным пользователем**
    - [ ] На экране логина ввести данные пользователя `alice@example.com`.
    - [ ] Нажать "Login".
    - [ ] Убедиться, что отображается сообщение об ошибке, и переход на другой экран не происходит.
- **`[E2E-3]` Сброс состояния приложения**
    - [ ] Добавить несколько товаров в корзину.
    - [ ] Открыть боковое меню, выбрать "Reset App State".
    - [ ] В диалоговом окне подтвердить сброс.
    - [ ] Убедиться, что иконка корзины в хедере показывает "0", а при переходе в корзину отображается экран "No Items".