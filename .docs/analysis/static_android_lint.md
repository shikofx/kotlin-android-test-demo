# Статический анализ с Android Lint

## 1. Для чего нужен Android Lint?

**Android Lint** — это официальный статический анализатор кода для Android, встроенный в Android Studio и Android Gradle Plugin. Его основная задача — находить проблемы, специфичные для платформы Android, которые могут повлиять на корректность, производительность, безопасность и удобство использования приложения.

В отличие от **Checkstyle** (стиль кода) и **PMD** (общие "code smells"), Lint анализирует код в контексте всей Android-экосистемы.

**Ключевые цели Android Lint:**
*   **Корректность:** Обнаруживает использование устаревших или неподходящих API.
*   **Производительность:** Находит неэффективные XML-разметки и узкие места в коде.
*   **Безопасность:** Указывает на потенциальные уязвимости (например, небезопасная работа с WebView).
*   **Доступность (Accessibility):** Проверяет, что приложением могут пользоваться люди с ограниченными возможностями (например, отсутствие `contentDescription` у изображений).
*   **Интернационализация (i18n):** Находит жестко закодированные строки, которые невозможно перевести.

## 2. Какие проверки он выполняет?

Lint выполняет сотни проверок. В нашем проекте используется `lint-baseline.xml` для временного игнорирования существующих проблем. Вот некоторые примеры проверок, которые были найдены и занесены в baseline:

| Категория | Описание и примеры проверок |
| :--- | :--- |
| **Корректность и API** | Проверяет правильность использования Android API и жизненного цикла. <br> - `ScopedStorage`: Использование устаревших разрешений `WRITE_EXTERNAL_STORAGE`. <br> - `SimpleDateFormat`: Создание `SimpleDateFormat` без указания `Locale`. <br> - `SetJavaScriptEnabled`: Включение JavaScript в `WebView` без должной осторожности. |
| **Производительность** | Находит неэффективные конструкции в XML и коде. <br> - `ScrollViewSize`: Использование `match_parent` для высоты внутри `ScrollView`. <br> - `UseCompoundDrawables`: Обнаруживает `LinearLayout` с `ImageView` и `TextView`, который можно заменить на один `TextView` с `drawable`. <br> - `UnusedResources`: Находит неиспользуемые ресурсы (строки, изображения, стили). |
| **Интернационализация (i18n)** | Обеспечивает готовность приложения к переводу на другие языки. <br> - `HardcodedText`: Обнаруживает жестко закодированные строки в XML-атрибутах `android:text`. <br> - `SetTextI18n`: Находит конкатенацию строк в `setText()`, которую следует заменить на форматированные ресурсы. |
| **Доступность (Accessibility)** | Проверяет, удобно ли приложение для людей с ограниченными возможностями. <br> - `ContentDescription`: Отсутствие `contentDescription` у `ImageView`. <br> - `SpUsage`: Использование `dp` вместо `sp` для размеров текста. <br> - `LabelFor`: Отсутствие метки для полей ввода. |
| **Совместимость** | Следит за совместимостью с разными версиями Android. <br> - `UnusedAttribute`: Использование XML-атрибутов, которые не работают на минимальной поддерживаемой версии API. <br> - `GradleDependency`: Уведомляет о наличии новых версий используемых библиотек. |

## 3. Настройка в проекте

### 3.1. Модульная конфигурация

Чтобы не загромождать основной файл `app/build.gradle`, вся логика настройки вынесена в отдельный скрипт `gradle/lint.gradle`. Он подключается одной строкой:

```groovy
// app/build.gradle
apply from: "$project.rootDir/gradle/lint.gradle"
```

В самом скрипте `gradle/lint.gradle` настраивается поведение Lint:

```groovy
// gradle/lint.gradle
android {
    lint {
        // Не прерывать сборку при наличии ошибок.
        abortOnError false

        // Включать предупреждения в отчет.
        ignoreWarnings false

        // Использовать baseline для игнорирования существующих проблем.
        baseline file("lint-baseline.xml")
    }
}
```

### 3.2. Baseline (Базовый уровень ошибок)

**Baseline** — это механизм, который позволяет "сфотографировать" все текущие проблемы, найденные Lint, и временно их игнорировать. Это мощный инструмент для управления техническим долгом.

*   **Как это работает:** При запуске `lintDebug` анализатор сначала читает `app/lint-baseline.xml`. Все ошибки, которые уже перечислены в этом файле, **игнорируются**. В итоговый отчет попадают **только новые ошибки**, которые появились в коде после создания baseline.

*   **Как обновить baseline:**
    1.  Исправьте одну или несколько ошибок в коде.
    2.  Запустите `./gradlew app:lintDebug` для генерации нового, "чистого" отчета.
    3.  Выполните команду `cp app/build/reports/lint-results-debug.xml app/lint-baseline.xml`, чтобы обновить baseline.
    4.  Закоммитьте и исправленный код, и обновленный `lint-baseline.xml`.

## 4. Интеграция с CI/CD

Анализ Lint является частью основной задачи `build_and_analyze` в файле `.github/workflows/android-ci.yml`.

1.  **Запуск анализатора:**
    ```yaml
    - name: Run Static Analysis (Android Lint)
      run: ./gradlew app:lintDebug
    ```

2.  **Публикация отчета:**
    После выполнения анализа специальный скрипт в CI/CD пайплайне находит сгенерированный `lint-results-debug.html`, а также `lint-baseline.xml`, и публикует их на GitHub Pages, делая доступными по ссылке на общей странице отчетов.