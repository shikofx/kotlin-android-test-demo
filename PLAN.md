# Детальный План Работы над проектом "kotlin-android-test-demo"

Этот документ является детализацией общего стратегического плана и описывает конкретные задачи для проекта `kotlin-android-test-demo`. Цель проекта — создать исчерпывающее портфолио, демонстрирующее эволюцию подходов к UI-тестированию в Android.

## Структура веток

Проект развивается поэтапно, и каждый этап представлен в отдельной ветке для наглядности.

| Ветка | Описание | Ключевые технологии |
| :--- | :--- | :--- |
| `1-infrastructure-setup` | **Подготовка инфраструктуры:** Настройка CI/CD, статического анализа Java-кода и сбора покрытия. | `GitHub Actions`, `GitLab CI`, `Docker`, `Checkstyle`, `PMD`, `JaCoCo` |
| `2-unit-tests` | **Модульное тестирование:** Написание Unit-тестов для бизнес-логики и интеграция с Allure TestOps. | `JUnit5`, `Allure TestOps` |
| `3-logic-refactoring` | **Рефакторинг бизнес-логики:** Исправление проблем, найденных статическим анализом, под защитой Unit-тестов. | `Java`, `Checkstyle`, `PMD` |
| `4-integration-tests` | **Интеграционное тестирование:** Написание тестов для проверки взаимодействия компонентов (например, слой БД). | `JUnit5`, `Room` |
| `5-integration-refactoring` | **Рефакторинг слоя данных:** Исправление кода, связанного с базой данных, под защитой интеграционных тестов. | `Java`, `Room` |
| `6-espresso-initial` | **Базовый уровень UI-тестов:** Реализация первых UI-тестов с использованием **Espresso**. | `Espresso`, `JUnit4` |
| `7-ui-refactoring` | **Рефакторинг UI-слоя:** Исправление кода UI-компонентов под защитой Espresso-тестов. | `Java`, `Espresso` |
| `8-kakao` | **Улучшение читаемости:** Тесты переписаны с использованием DSL-обертки **Kakao**, внедрен паттерн Page Object. | `Kakao`, `Page Object` |
| `9-kaspresso` | **Стабильность и мощь:** Тесты мигрированы на фреймворк **Kaspresso** для повышения стабильности и работы со сложными сценариями. | `Kaspresso`, `BrowserStack` |
| `10-kotlin-conversion` | **Рефакторинг:** Проведен масштабный рефакторинг исходного кода приложения под защитой Kaspresso-тестов. | `Kotlin`, `ViewBinding`, `Gradle KTS` |
| `main` | **Основная ветка:** Содержит последнюю стабильную версию проекта. Все завершенные этапы сливаются сюда. | - |

---

## Этап 1: Настройка инфраструктуры и CI/CD (11.09 - 20.09)

**Цель:** Создать надежный фундамент для разработки и тестирования. Настроить CI/CD пайплайны, интегрировать статический анализ и сбор покрытия для **Java-кода**.

*   [ ] **Ветка:** `1-infrastructure-setup`
*   [ ] **Задачи по коду:**
    *   [ ] Разработать тест-план (`TESTING_STRATEGY.md`).
*   [ ] **Задачи по CI/CD (GitHub Actions):**
    *   [ ] Создать workflow `.github/workflows/ci.yml`.
    *   [ ] Настроить job `build` для сборки debug APK.
    *   [ ] Интегрировать статические анализаторы для Java: **Checkstyle** и **PMD**.
    *   [ ] Настроить Quality Gate (QG) для статического анализа: пайплайн должен падать при наличии критических ошибок.
*   [ ] **Задачи по CI/CD (GitLab CI):**
    *   [ ] Создать `Dockerfile` для сборки Android-проекта.
    *   [ ] Создать workflow `.gitlab-ci.yml`.
    *   [ ] Настроить job `build` для сборки debug APK с использованием Docker-образа.
*   [ ] **Задачи по анализу покрытия кода:**
    *   [ ] Настроить **JaCoCo** для сбора и генерации отчетов о покрытии кода тестами.
    *   [ ] Настроить Quality Gate (QG) для покрытия: пайплайн должен падать, если покрытие ниже установленного порога (например, 50%).
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `1-infrastructure-setup` в `main`.

## Этап 2: Модульное тестирование (Unit Tests) и интеграция с Allure (21.09 - 28.09)

**Цель:** Написать первые модульные тесты для бизнес-логики. Настроить интеграцию с Allure TestOps, разобраться с его возможностями и научиться отправлять в него результаты тестов и артефакты.

*   [ ] **Ветка:** `2-unit-tests` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Написать Unit-тесты для бизнес-логики и ViewModel, используя **JUnit 5**, **MockK** и **Truth**.
*   [ ] **Задачи по CI/CD (GitHub Actions):**
    *   [ ] Настроить job `unit-test` для запуска Unit-тестов (`./gradlew test`).
    *   [ ] Обновить Quality Gate: пайплайн должен падать при провале тестов.
*   [ ] **Задачи по интеграции с Allure:**
    *   [ ] Развернуть стенд Allure TestOps (локально через Docker или использовать облачную версию).
    *   [ ] Добавить плагин Allure в Gradle.
    *   [ ] Настроить пайплайн для отправки результатов тестов, статического анализа и отчетов о покрытии в Allure TestOps/Allure Report.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `2-unit-tests` в `main`.

## Этап 3: Рефакторинг бизнес-логики (29.09 - 02.10)

**Цель:** Исправить проблемы в Java-коде, обнаруженные статическими анализаторами (Checkstyle, PMD). Рефакторинг проводится безопасно, так как код покрыт Unit-тестами.

*   [ ] **Ветка:** `3-logic-refactoring` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Проанализировать отчеты статического анализа.
    *   [ ] Провести рефакторинг классов с бизнес-логикой (`SingletonClass`, `ViewModels` и т.д.).
    *   [ ] Убедиться, что все Unit-тесты по-прежнему проходят после рефакторинга.
*   [ ] **Задачи по CI/CD:**
    *   [ ] Убедиться, что после рефакторинга пайплайн проходит проверки статического анализа (Checkstyle, PMD).
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `3-logic-refactoring` в `main`.

## Этап 4: Интеграционное тестирование (03.10 - 09.10)

**Цель:** Проверить корректность взаимодействия между компонентами, в первую очередь — работу с базой данных (Room).

*   [ ] **Ветка:** `4-integration-tests` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Написать интеграционные тесты для `AppDao` с использованием in-memory базы данных на **JUnit 5**.
    *   [ ] Проверить операции вставки, чтения, удаления и сортировки.
*   [ ] **Задачи по CI/CD:**
    *   [ ] Добавить в пайплайн job для запуска интеграционных тестов.
    *   [ ] Убедиться, что результаты тестов и обновленное покрытие кода отправляются в Allure.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `4-integration-tests` в `main`.

## Этап 5: Рефакторинг слоя данных (10.10 - 12.10)

**Цель:** Улучшить код, связанный с базой данных и репозиториями, под защитой написанных интеграционных тестов.

*   [ ] **Ветка:** `5-integration-refactoring` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Провести рефакторинг `AppDao`, `AppDatabase`, `DatabaseRepository`.
    *   [ ] Убедиться, что все интеграционные тесты проходят после рефакторинга.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `5-integration-refactoring` в `main`.

## Этап 6: UI-тестирование (Espresso) (13.10 - 16.10)

**Цель:** Написать первые UI-тесты и интегрировать их результаты в существующую CI/CD и Allure-инфраструктуру.

*   [ ] **Ветка:** `6-espresso-initial` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Написать UI-тесты на Espresso (на **JUnit 4**) для сценариев "Логин" и "Просмотр каталога".
*   [ ] **Задачи по CI/CD (GitHub Actions):**
    *   [ ] Настроить job `ui-test`, который зависит от `build`:
        *   [ ] Использовать `reactivecircus/android-emulator-runner` для запуска эмулятора.
        *   [ ] Запустить `./gradlew connectedCheck`.
    *   [ ] Обновить пайплайн для отправки результатов UI-тестов в Allure.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `6-espresso-initial` в `main`.

## Этап 7: Рефакторинг UI-слоя (17.10 - 19.10)

**Цель:** Улучшить код UI-компонентов (`Fragments`, `Activities`), который теперь покрыт Espresso-тестами.

*   [ ] **Ветка:** `7-ui-refactoring` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Провести рефакторинг `LoginFragment`, `ProductCatalogFragment` и связанных `Activities`.
    *   [ ] Убедиться, что все существующие тесты (Unit, Integration, Espresso) проходят после рефакторинга.
*   [ ] **Задачи по CI/CD:**
    *   [ ] Убедиться, что пайплайн успешно проходит все этапы (сборка, анализ, все виды тестов).
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `7-ui-refactoring` в `main`.

## Этап 8: Улучшение читаемости тестов с Kakao (20.10 - 26.10)

**Цель:** Улучшить поддерживаемость тестов с помощью DSL Kakao и паттерна Page Object.

*   [ ] **Ветка:** `8-kakao` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Провести рефакторинг существующих Espresso-тестов на Kakao.
    *   [ ] Реализовать Page Objects для экранов Login и Catalog.
    *   [ ] Написать новые тесты для флоу "Добавление товара в корзину".
*   [ ] **Задачи по CI/CD:**
    *   [ ] Убедиться, что тесты на Kakao корректно запускаются в существующих пайплайнах GitHub Actions и GitLab CI.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `8-kakao` в `main`.

## Этап 9: Современный подход с Kaspresso (27.10 - 07.11)

**Цель:** Освоить фреймворк Kaspresso, покрыть сложные сценарии, интегрироваться с облачными фермами.

*   [ ] **Ветка:** `9-kaspresso` (создается из `main`)
*   [ ] **Задачи по коду:**
    *   [ ] Провести миграцию тестов с Kakao на Kaspresso.
    *   [ ] Реализовать сложные тесты с использованием API Kaspresso:
        *   [ ] Тест, который предоставляет/запрещает разрешения (permissions).
        *   [ ] Тест, который выполняет ADB-команды (например, включение/выключение Wi-Fi).
    *   [ ] Расширить покрытие Unit-тестами для ViewModel и репозиториев.
    *   [ ] Достичь 100% покрытия тест-плана UI-тестами и высокого покрытия кода Unit-тестами.
*   [ ] **Задачи по CI/CD:**
    *   [ ] Интегрировать пайплайн с **BrowserStack** (или аналогичным облачным провайдером) для запуска тестов на реальных устройствах.
    *   [ ] Настроить интеграцию с **Allure TestOps**:
    *   [ ] Улучшить интеграцию с **Allure TestOps**:
        *   [ ] Пайплайн должен отправлять результаты в TestOps.
        *   [ ] Настроить запуск тестов из интерфейса TestOps.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `9-kaspresso` в `main`.

## Этап 10: Рефакторинг и финализация (08.11 - 18.11)

**Цель:** Привести кодовую базу приложения в идеальное состояние, продемонстрировав практику безопасного рефакторинга под защитой тестов, и оптимизировать CI.

*   [ ] **Ветка:** `10-kotlin-conversion` (создается из `main`)
*   [ ] **Задачи по коду (рефакторинг под защитой тестов):**
    *   [ ] **Шаг 1:** Полностью конвертировать исходный код приложения из Java в Kotlin.
    *   [ ] **Шаг 2:** Перевести все Gradle-скрипты (`build.gradle`) на Kotlin DSL (`build.gradle.kts`).
    *   [ ] **Шаг 3:** Заменить использование `findViewById` на `ViewBinding`.
*   [ ] **Задачи по CI/CD:**
    *   [ ] Заменить инструменты анализа Java (`Checkstyle`, `PMD`) на инструменты для Kotlin (`Detekt`, `Ktlint`).
    *   [ ] Настроить **кэширование Gradle-зависимостей** для ускорения сборок.
    *   [ ] Настроить **распараллеливание тестов (sharding)** для сокращения времени выполнения.
*   [ ] **Финализация:**
    *   [ ] Выполнить слияние ветки `10-kotlin-conversion` в `main`.
    *   [ ] Обновить `README.md` проекта, описав финальный стек, структуру и все проделанные шаги.
